_config:
  _metadata:
    description: modularize-web
    name: modularize-web
    namespace: default
    template:
      type: template.caicloud.io/application
      version: 1.0.0
    version: 'v0.4.4'
  controllers:
    - containers:
        - env:
            - name: NODE_ENV
              value: 'production'
            - name: GRAFANA_PORT
              value: '6104'
            - name: MONGODB_URL
              value: '[[ platform_mongo_host ]]'
            - name: REDIS_HOST
              value: 'web-redis'
            - name: REDIS_PORT
              value: '6379'
            - name: HIDE_MENU
              value: caas_circle
            - name: HIDE
              value: forget
            - name: CLOUD_ENV
              value: private
            - name: OEM_ENV
              value: '0'
            - name: HODOR_SERVER
              value: http://hodor:8080
            - name: EXTERNAL_HODOR
              from:
                type: Config
                name: platform-config
                key: 'hodorEndpoint'
            - name: MONITOR_SERVER
              value: http://monitoring-admin:8899/api/v1
            - name: CAUTH_SERVER
              value: http://dex-cauth:8080/api/v2
            - name: CLUSTER_SERVER
              value: http://cluster-admin:2233/api/v2alpha1
            - name: CAICLOUD_PRODUCT_CFG_STRING_MULTI_TENANCY
              from:
                type: Config
                name: platform-config
                key: 'tenantMode'
            - name: ISSUER
              from:
                type: Config
                name: platform-config
                key: 'oidcIssuer'
            - name: ISSUER_PORT
              value: '6060'
            - name: COMPASS_PORT
              value: '6060'
            - name: CLEVER_PORT
              value: '6061'
            - name: USERWEB_PORT
              value: '6060'
            - name: ISSUER_PREFIX_URL
              from:
                type: Config
                name: platform-config
                key: ssoBasePath
            - name: OIDC_CLIENT_ID
              value: compass-web
            - name: OIDC_CLIENT_SECRET
              value: compass-web
            - name: CONSOLE_BASE_PATH
              from:
                type: Config
                name: platform-config
                key: 'consoleBasePath'
            - name: USERWEB_BASE_PATH
              from:
                type: Config
                name: platform-config
                key: 'userwebBasePath'
            - name: CLEVER_BASE_PATH
              value: ''
            - name: COMPASS_SERVER
              from:
                type: Config
                name: platform-config
                key: 'compassWebEndpoint'
            - name: CLEVER_SERVER
              from:
                type: Config
                name: platform-config
                key: 'cleverServer'
            - name: 'USERWEB_SERVER'
              from:
                type: Config
                name: platform-config
                key: 'userwebServer'
            - name: CLEVER_ON
              from:
                type: Config
                name: platform-config
                key: 'cleverOn'
            - name: SHOW_LANG
              value: 'false'
            - name: DEFAULT_LANG
              value: 'zh-CN'
            - name: NODE_TLS_REJECT_UNAUTHORIZED
              value: '0'
            # Get release info from system-info ConfigMap
            - name: PRODUCT_VERSION
              value: '[[ platform_release_version ]]'
            - name: PRODUCT_RELEASE_TIME
              value: '[[ platform_release_time ]]'
            - name: TUTORIAL_LINK
              value: 'tutorial'
            - name: PORT
              value: '4000'
            - name: COOKIE_NAME
              value: compass-web-sess
            - name: COOKIE_SECRET
              value: c2a0i1c6l0o3u2d
            - name: RECOMMEND_QUOTA_LEAST_DAY
              value: '1'
            - name: RECOMMEND_QUOTA_PERCENTILE
              value: '95'
            - name: RECOMMEND_QUOTA_STEP
              value: '1800'
          image: '[[ registry_release ]]/modularize-web:v0.4.4'
          imagePullPolicy: IfNotPresent
          ports:
            - port: 4000
              protocol: TCP
      controller:
        replica: 1
        strategy:
          surge: 1
          unavailable: 0
      services:
        - name: modularize-web
          ports:
            - protocol: TCP
              port: 4000
          type: ClusterIP
      type: Deployment
