_config:
  _metadata:
    description: devops-web
    name: devops-web
    namespace: default
    template:
      type: template.caicloud.io/application
      version: 1.0.0
    version: 'v0.0.1-alpha'
  controllers:
    - containers:
        - env:
            - name: NODE_ENV
              value: 'production'
            - name: MONGODB_URL
              value: '[[ platform_mongo_host ]]'
            - name: HODOR_SERVER
              value: http://hodor:8080
            - name: EXTERNAL_HODOR
              from:
                type: Config
                name: platform-config
                key: 'hodorEndpoint'
            - name: MONITOR_SERVER
              value: http://monitoring-admin:8899/api/v1
            - name: ISSUER
              from:
                type: Config
                name: platform-config
                key: 'oidcIssuer'
            - name: ISSUER_PORT
              value: '6060'
            - name: ISSUER_PREFIX_URL
              from:
                type: Config
                name: platform-config
                key: ssoBasePath
            - name: OIDC_CLIENT_ID
              value: compass-web
            - name: OIDC_CLIENT_SECRET
              value: compass-web
            - name: CONSOLE_BASE_PATH
              from:
                type: Config
                name: platform-config
                key: 'consoleBasePath'
            - name: CLEVER_ON
              from:
                type: Config
                name: platform-config
                key: 'cleverOn'
            - name: NODE_TLS_REJECT_UNAUTHORIZED
              value: '0'
            # Get release info from system-info ConfigMap
            - name: PORT
              value: '3002'
            - name: MODULARIZE_WEB_SERVICE
              value: 'http://modularize-web:4000'
          image: '[[ registry_release ]]/devops-web:v0.0.1-alpha'
          imagePullPolicy: IfNotPresent
          ports:
            - port: 3002
              protocol: TCP
      controller:
        replica: 1
        strategy:
          surge: 1
          unavailable: 0
      services:
        - name: devops-web
          ports:
            - protocol: TCP
              port: 3002
          type: ClusterIP
      type: Deployment
