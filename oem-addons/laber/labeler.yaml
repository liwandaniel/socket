_config:
  _metadata:
    description: clever-labeler
    name: clever-labeler
    namespace: default
    template:
      type: template.caicloud.io/application
      version: 1.0.0
    version: "v0.1.1"
  controllers:
  - containers:
    - env:
      - name: POSTGRES_HOST
        value: labeler-postgres
      - name: POSTGRES_PORT
        value: "5432"
      - name: POSTGRES_DBNAME
        value: "postgres"
      - name: POSTGRES_USER
        value: "postgres"
      - name: FILESERVER_HOST
        value: '[[ kube_apiserver_endpoint_ip ]]'
      - name: FILESERVER_PORT
        value: "32003"
      image: '[[ registry_release ]]/labeler:v0.1.1'
      imagePullPolicy: IfNotPresent
      mounts:
      - name: labeler-storage
        path: /clever/labels
      ports:
      - port: 5000
        protocol: TCP
      resources:
        limits:
          cpu: 200m
          memory: 256Mi
        requests:
          cpu: 100m
          memory: 128Mi
      command:
      - /bin/sh
      - -c
      - /bin/labeler
    controller:
      replica: 1
    initContainers:
    - command:
      - /bin/sh
      - -c
      - until nslookup labeler-postgres; do echo waiting for postgres; sleep 2;
        done;
      image: '[[ registry_release ]]/alpine:3.6'
      imagePullPolicy: IfNotPresent
    pod:
      serviceAccountName: admin
    services:
    - name: clever-labeler
      ports:
      - port: 5000
        nodePort: 32002
        protocol: TCP
      type: NodePort
    type: Deployment
    volumes:
    - name: labeler-storage
      type: Dynamic
      source:
        class: heketi-storageclass
        modes:
        - ReadWriteMany
      storage:
        request: 10Gi
        limit: 10Gi